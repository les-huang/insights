<html>

<head>
    <title>Insights</title>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script type="text/javascript" src="price_dist_chart.js"></script>
    <script type="text/javascript" src="radial_chart.js"></script>
    <script type="text/javascript" src="filter.js"></script>
    <script type="text/javascript" src="scatter_plot.js"></script>
    <script type="text/javascript" src="helper.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cabin&display=swap" rel="stylesheet">
    <script src="//unpkg.com/d3-radial-axis"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ðŸ’¤</text></svg>">
</head>

<body style="text-align: center; background-color: #fbfbfb; ">
    <select name="Categories" id="dropdown" style="padding: 10px; font-family: 'Cabin'; font-weight: bold;">
    </select>
  <svg height="500" width="700" class="priceDistVis"></svg>
  <svg height="700" width="900" class="radialTimeVis"></svg>
  <svg height="700" width="600" class="scatterVis"></svg>

  <script>
    let PI = Math.PI;
    let padding = 25;

    let textColor = "#696969";
    let blueArcColor = "#7389AE";
    let allNighterColor = "#F4B266"; // orange
    let backgroundColor = "#e8e8e8";
    let darkGreyColor = "#282828";
    let greenColor = "#709970";

    const getInitialLineChartData = async() => {
        var url = 'http://0.0.0.0:8080/prices/item/Cookies';
        let response = await fetch(url);
        let data = await response.json();
        return data;
    }

    const getCategories = async() => {
        let fakeData = {
            "Food": ["Cookies", "Bread"],
            "Health": ["Band-aids", "Cough Drops"],
            "Beverage": ["Arizona Tea"]
        }
        return fakeData;
    }

    getInitialLineChartData().then(data => {
        drawPriceChart(".priceDistVis", data);
        drawRadialChart(".radialTimeVis");

        let fakeData = [
            {"x": 50, "y": 900},
            {"x": 70, "y": 200},
            {"x": 72, "y": 300},
            {"x": 36, "y": 400},
            {"x": 50, "y": 750},
            {"x": 94, "y": 850},
            {"x": 28, "y": 550},
            {"x": 85, "y": 220},
            {"x": 62, "y": 890},
            {"x": 98, "y": 70},
            {"x": 34, "y": 90},
        ]
        drawScatterPlot(".scatterVis", fakeData);
    });

    getCategories().then(data => {
        var dropdown = document.getElementById("dropdown");
        for (var cat of Object.keys(data)) {
            var option = document.createElement("option");
            option.text = cat;
            dropdown.add(option);
        }
        dropdown.addEventListener("change", function(d) {
            let newCat = d3.select(this).property("value");
            let temp = data[newCat][0].replace(/\s/g, '');
            changeFilters(data[newCat][0]).then(function(newData) {
                d3.select(".priceDistVis").selectAll("*").remove();
                drawPriceChart(".priceDistVis", newData);
                addFilters(".priceDistVis", data[newCat], temp);
            });
        })
        addFilters(".priceDistVis", data[Object.keys(data)[0]], data[Object.keys(data)[0]][0].replace(/\s/g, ''));
    });

    async function changeFilters(item) {
        var url = 'http://0.0.0.0:8080/prices/item/' + item;
        let response = await fetch(url);
        let data = await response.json();
        return data;
    }
  </script>
</body>
</html>
